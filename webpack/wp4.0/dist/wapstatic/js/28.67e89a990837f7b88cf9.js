webpackJsonp([28],{Gw3i:function(t,a){},Hz0Q:function(t,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var e=s("wSez"),o={name:"Order",data:function(){return{flag:!1,selected:"1",isUnscRollable:!1,backParentPage:!1,popupSendWay:!1,sendValue:[],params:this.$store.state.buyProductInfo,productData:"",isDefaultAddress:!1,defaultAddList:"",defaultExp:"",remaks:""}},components:{"mt-field":e.Field,"mt-header":e.Header,"mt-button":e.Button,"mt-tab-container":e.TabContainer,"mt-tab-container-item":e.TabContainerItem,"mt-cell":e.Cell,"mt-popup":e.Popup,"mt-radio":e.Radio},computed:{proCount:function(){return"￥"+(this.productData.ourPrice*this.params.num).toFixed(2)},orderCount:function(){return this.defaultExp.byWeight?"￥"+(this.productData.ourPrice*this.params.num+this.defaultExp.byWeight.charge).toFixed(2):"￥"+(this.productData.ourPrice*this.params.num).toFixed(2)},showAddress:function(){return this.isDefaultAddress}},filters:{chargeFilter:function(t){return t&&0!==t.charge?"¥ "+t.charge:"¥ 0.00"}},updated:function(){this.$store.state.buyProductAdd&&(this.isDefaultAddress=!0,this.defaultAddList=this.$store.state.buyProductAdd)},mounted:function(){this.$emit("changeClass",!1)},destroyed:function(){this.$emit("changeClass",!0)},created:function(){var t=this;this.$store.state.buyProductAdd?t.$options.methods.getCharge(t,t.$store.state.buyProductAdd.addressID):this.$ajax({method:"get",url:t.webRoot+"/delivery/getDeliveryAddress?memberId="+t.$store.state.memberId}).then(function(a){0==a.data.length||0==a.data[0].isDefault?t.isDefaultAddress=!1:(t.defaultAddList=a.data[0],t.isDefaultAddress=!0,t.$options.methods.getCharge(t,a.data[0].addressID))}).catch(function(t){console.log(t)}),this.$ajax({url:t.webRoot+"/product/getProductByProductId",data:{productId:t.params.orderId}}).then(function(a){if(a.data.success){if(!a.data.data)return t.$options.methods.showToast(a.data.msg),!1;t.productData=a.data.data}else t.$options.methods.showToast(a.data.msg)}).catch(function(t){console.log(t)})},methods:{comfireOrder:function(){var t=this,a=this.defaultAddList.city;return!this.flag&&(a?(this.flag=!0,void e.MessageBox.confirm("确定执行此操作?",{closeOnClickModal:!1}).then(function(s){t.$ajax({url:t.webRoot+"/order/addorder",data:{productId:t.params.orderId,memberId:t.$store.state.memberId,detailCodeId:t.params.specId,qty:t.params.num,addressID:t.defaultAddList.addressID,deliveryAddress:a,logisticsID:t.defaultExp.logisticsID,payType:4,orderRemark:t.remaks,sysNo:"WAP端"}}).then(function(a){a.data.success?(gtag("event","立即购买",{event_category:t.productData.productID,event_label:"成功"}),t.$options.methods.showToast(a.data.msg),t.$store.commit("addBuyProductInfo",""),t.$store.commit("addBbuyProductAdd",""),t.$router.go(-1)):(gtag("event","立即购买",{event_category:t.productData.productID,event_label:"失败"}),t.$options.methods.showToast(a.data.msg)),t.flag=!1}).catch(function(t){console.log(t)})}).catch(function(a){console.log(a),t.flag=!1})):(t.$options.methods.showToast("请选择收货地址!"),!1))},selectSendWay:function(t,a){this.defaultExp=t},chooseSendWay:function(){this.popupSendWay=!0},closeSendWay:function(){this.popupSendWay=!1},goBack:function(){this.$router.go(-1)},btnSave:function(){console.log("点击确定")},jumpAddress:function(){this.$router.push({path:"/myinfo/address?form=purch"})},getCharge:function(t,a){t.$ajax({url:t.webRoot+"/order/getLogisticsCharge",data:{addressId:a}}).then(function(a){if(0==a.data.length)return t.$options.methods.showToast("无配送方式"),!1;t.sendValue=a.data;for(var s=0;s<a.data.length;s++)if(9==a.data[s].logisticsID){t.defaultExp=a.data[s];break}}).catch(function(t){console.log(t)})},showToast:function(t,a){a=a||2e3;Object(e.Toast)({message:t,position:"center",duration:a})},changeClassOne:function(t){t?(this.backParentPage=!0,this.isUnscRollable=!1):(this.backParentPage=!1,this.isUnscRollable=!0)}}},d={render:function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("section",{staticClass:"wrap has_header_wrap c_wrap purchase_wrap"},[s("section",{staticClass:"wrap_in",class:{unscrollable:t.isUnscRollable}},[s("mt-header",{attrs:{fixed:"",title:"订单确认"}},[s("mt-button",{attrs:{slot:"left",icon:"back"},on:{click:function(a){return a.preventDefault(),t.goBack(a)}},slot:"left"})],1),t._v(" "),s("div",{staticClass:"purchase_info"},[s("div",{staticClass:"block"},[t.showAddress?s("div",{staticClass:"address",on:{click:t.jumpAddress}},[s("h3",[s("span",[t._v("收货人：")]),s("span",[t._v(t._s(t.defaultAddList.contactMan))])]),t._v(" "),s("p",[t._v("收货地址：")]),t._v(" "),s("p",[t._v(t._s(t.defaultAddList.address))])]):t._e(),t._v(" "),t.showAddress?t._e():s("router-link",{staticClass:"add_address_btn",attrs:{to:"myinfo/address?form=purch"}},[s("i",{staticClass:"icons_add"}),t._v(" "),s("span",{staticClass:"inline_block"},[t._v("添加收货地址")])])],1),t._v(" "),s("div",{staticClass:"block lists"},[s("div",{staticClass:"item d_flex"},[s("div",{staticClass:"i_img"},[s("img",{directives:[{name:"lazy",rawName:"v-lazy",value:t.productData.photodURL,expression:"productData.photodURL"}],attrs:{alt:t.productData.productName}})]),t._v(" "),s("div",{staticClass:"i_info"},[s("p",{staticClass:"d_flex"},[s("span",[t._v(t._s(t.productData.productName))]),s("span",[t._v(t._s(t.productData.ourPrice?"￥"+t.productData.ourPrice:""))])]),t._v(" "),s("p",{staticClass:"d_flex"},[s("span",[t._v(t._s(t.params.specName?t.params.specName:t.productData.spec))]),s("span",[t._v(t._s("x"+t.params.num))])])])])]),t._v(" "),s("div",{staticClass:"block",on:{click:t.chooseSendWay}},[s("mt-cell",{attrs:{title:"配送方式","is-link":""}}),t._v(" "),s("mt-cell",{staticClass:"isSendWay"},[s("span",{attrs:{slot:"title"},slot:"title"},[s("span",[t._v(t._s(t.defaultExp.logisticsName))]),s("span",[t._v("运费"+t._s(t._f("chargeFilter")(t.defaultExp.byWeight)))])])])],1),t._v(" "),s("div",{staticClass:"block pay_way"},[s("mt-cell",{attrs:{title:"支付方式",value:"货到付款"}}),t._v(" "),s("p",[t._v("目前只支持货到付款，您提交订单后，我们将货送到您手中再收费。")])],1),t._v(" "),s("div",{staticClass:"block pay_way"},[s("mt-field",{attrs:{label:"备注信息",placeholder:"写下您的要求，让我们更好的为您服务。",type:"textarea",rows:"4"},model:{value:t.remaks,callback:function(a){t.remaks=a},expression:"remaks"}})],1),t._v(" "),s("div",{staticClass:"block counts"},[s("p",{staticClass:"d_flex"},[s("span",[t._v("商品总额：")]),s("span",[t._v(t._s(t.proCount))])]),t._v(" "),s("p",{staticClass:"d_flex"},[s("span",[t._v("运费：")]),s("span",[t._v("+ "+t._s(t._f("chargeFilter")(t.defaultExp.byWeight)))])]),t._v(" "),s("div",{staticClass:"all_count d_flex"},[s("span",[t._v("订单总额：")]),t._v(" "),s("span",{staticClass:"r_color"},[t._v(t._s(t.orderCount))])])]),t._v(" "),s("div",{staticClass:"footer_btns d_flex"},[s("p",[s("span",[t._v("实付金额: ")]),s("span",{staticClass:"r_color"},[t._v(t._s(t.orderCount))])]),t._v(" "),s("button",{on:{click:t.comfireOrder}},[t._v("确认订单")])]),t._v(" "),s("mt-popup",{staticClass:"sendWay",attrs:{position:"bottom"},model:{value:t.popupSendWay,callback:function(a){t.popupSendWay=a},expression:"popupSendWay"}},[s("h3",{staticClass:"d_flex"},[s("span",[t._v("配送方式")]),s("i",{on:{click:t.closeSendWay}},[t._v("X")])]),t._v(" "),s("ul",t._l(t.sendValue,function(a,e){return s("li",{on:{click:function(s){t.selectSendWay(a,e)}}},[s("label",{attrs:{isradio:""}},[s("input",{attrs:{name:"sendWay",type:"radio"},domProps:{checked:a.logisticsID==t.defaultExp.logisticsID}}),t._v(" "),s("i"),s("span",[t._v(t._s(a.logisticsName)),s("i",[t._v("运费"+t._s(t._f("chargeFilter")(a.byWeight)))])])])])}))])],1)],1),t._v(" "),s("transition",{attrs:{name:"fade"}},[s("router-view",{on:{changeClass:t.changeClassOne}})],1)],1)},staticRenderFns:[]};var i=s("vSla")(o,d,!1,function(t){s("Gw3i")},"data-v-40ad83c2",null);a.default=i.exports}});
//# sourceMappingURL=28.67e89a990837f7b88cf9.js.map