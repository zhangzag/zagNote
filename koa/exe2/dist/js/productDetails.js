function tips(e,t){layui.use("layer",function(){layer.msg(e,{icon:t,time:1e3})})}function priceInit(e){var t=String(e).indexOf(".")+1,a=String(e).length-t;return-1==String(e).indexOf(".")?e+".00":a<=1?e+"0":e}function getUser(){for(var e=document.cookie.split("; "),t=0;t<e.length;t++){var a=e[t].split("=");if("memberId"==a[0]&&"null"!=a[1])return unescape(a[1])}}function imgSrcInit(e){return""===e?"/static/images/ak_200x200.jpg":-1==e.indexOf("http://192.168.2.250:8081")?"http://192.168.2.250:8081"+e:e}function requireGtag(e){var t=e.title||"提交需求登记",a=e.content||{};gtag("event",t,a)}$(function(){var i=window.location.host;i=-1==i.indexOf(".ak1ak1.com")?"":".ak1ak1.com";window.location.search.split("=")[1];var r="",n=null;function l(e){$.ajax({url:"/favorite/getFavoriteList",type:"POST",dataType:"json",data:{memberId:e,limit:100,page:1},success:function(e){for(var t=0;t<e.date.length;t++)if(r==e.date[t].productID)return $("#collBtn").html('<i class="layui-icon layui-icon-star-fill"></i> 已收藏'),!1;$("#collBtn").html('<i class="layui-icon layui-icon-star"></i> 收藏')}})}$.ajax({url:"/products/pro",method:"GET",async:!1}).done(function(e){if(console.log(e),!e.data)return window.history.back(),!1;n=e.data,r=e.data.productID}),$("#zoomContainer .zoomItem li").eq(0).addClass("jxfzoomy-active"),$("#zoomContainer").jxfZoomy({smallBoxW:400,smallBoxH:400,bigBoxW:500,bigBoxH:500,smallListImgW:66,smallListImgH:50,moveSpeed:100}),$(".pro-i .reduce").click(function(){var e=$.trim($(this).next().val());if(!/^[0-9]*$/.test(e))return tips("请输入数字",2),$(this).next().val(1),!1;e=--e<1?1:e,$(this).next().val(e),d(),p()}),$(".pro-i .add").click(function(){var e=$.trim($(this).prev().val());if(!/^[0-9]*$/.test(e))return tips("请输入数字",2),$(this).prev().val(1),!1;e++,$(this).prev().val(e),d(),p()}),$("#productNumber").blur(function(){var e=$.trim($(this).val());/^[0-9]*$/.test(e)||(tips("请输入数字",2),e=1),$(this).val(e),d(),p()}),$(".minute-menu li").click(function(){$(this).addClass("menu-active").siblings().removeClass("menu-active"),$(".product-detail .p-detail").eq($(this).index()).css({display:"block"}).siblings().css({display:"none"}),2==$(this).index()&&$("#aboutAK").load("/aboutAK.html?n="+Math.random().toFixed(3))}),$.getGlobalVal().memberId?l($.getGlobalVal().memberId):$("#collBtn").html('<i class="layui-icon layui-icon-star"></i> 收藏'),$("#collBtn").click(function(){var e=getUser();if(!e){var t={};return t.getColl=l,$.loginAlert(t),!1}if(0<$(this).find(".layui-icon-star-fill").length)return $.ajax({url:"/favorite/delFavoriteBymemberIdAndProId",type:"POST",dataType:"json",data:{memberId:e,productId:r},success:function(e){tips(e.msg,1),$("#collBtn").html('<i class="layui-icon layui-icon-star"></i> 收藏')},error:function(e){}}),!1;$.ajax({url:"/favorite/addFavorite",type:"POST",dataType:"json",data:{memberID:e,productID:n.productID},success:function(e){e.success?(gtag("event","收藏",{event_category:"收藏商品id："+n.productID}),tips(e.msg,1),$("#collBtn").html('<i class="layui-icon layui-icon-star-fill"></i> 已收藏')):tips(e.msg,2)},error:function(e){tips(e.responseJSON.msg,2)}})});$(".demand-btn").click(function(){/^[0-9]*$/.test($("#productNumber").val())||$("#productNumber").val(1);var e=$("#productNumber").val();return $.require({path:0,product:n,qty:e,getColl:l,requireGtag:requireGtag}),!1}),$("#nowBuy").click(function(){if(!getUser()){var e={};return e.getColl=l,$.loginAlert(e),!1}if(!/^[0-9]*$/.test($.trim($("#productNumber").val())))return tips("请输入数字",2),$("#productNumber").val(1),!1;gtag("event","点击立即购买",{event_category:"点击立即购买商品id："+n.productID});var t=$(".singleMeal .liaoCheng .active").attr("index");if(t){var a=Number($(".you span").html().split("￥")[1]);window.location.href="/submitOrder.html",$.cookie("order",JSON.stringify({orderType:2,productId:r,qty:Number($("#productNumber").val()),packageID:u[t].packageID,index:t,discountMoney:a}),{path:"/",domain:i})}else window.location.href="/submitOrder.html",$.cookie("order",JSON.stringify({orderType:1,productId:r,qty:Number($("#productNumber").val())}),{path:"/",domain:i})});var s=null;$.ajax({url:"/getComboByProductId",type:"POST",dataType:"json",data:{productID:r},success:function(e){if(!e.success||e.data.length<=0)return $(".setmeal-wrap").css({display:"none"}),!1;s=e.data,$(".setmeal-wrap").css({display:"block"});for(var t="",a=0;a<5&&s[a];a++)t+="<li>"+s[a].packageName+"</li>";$(".setTitle ul").html(t),$(".setTitle ul").find("li").eq(0).addClass("active"),c(s[0],0)},error:function(e){$(".setmeal-wrap").css({display:"none"})}}),$(".setTitle ul").on("click","li",function(){var e=$(this).index();$(this).addClass("active").siblings().removeClass("active"),c(s[e],$(this).index())});var o=null;function c(e,t){var a=e;$(".setmeal").attr({packageID:a.packageID,productId:r,packageIndex:t}),$(".setmeal-r .taoPri span").html(priceInit(a.afterBenefitCost)),$(".setmeal-r .oldPri").html("￥"+priceInit(a.oldCost)),$(".setmeal .docSay h3").html(a.packageName),$(".setmeal .sayContent p").html(a.useDesc?a.useDesc:"暂无点评"),$.ajax({url:"/getComboDetailByPackageId",type:"POST",dataType:"json",data:{packageID:a.packageID},success:function(e){var t=e.data;o=e.data;for(var a="",i=0;i<t.length;i++){var r;r=t[i].photodURL?t[i].photodURL:"/static/images/ak_200x200.jpg",a+='<li><a href="/products/'+t[i].productID+'.html"><img src="'+r+'" /></a><div class="name">'+t[i].productName+'</div><div class="mealProInfo"><span class="price">￥ '+priceInit(t[i].price)+'</span><span class="count">x'+t[i].qty+"件</span></div></li>"}$(".featur_pro").html(a),$(".mealBtnWrap").html('<button class="mealDemand">需求登记</button>');var n=0;t.length<=4?($("#feature_next").css({display:"none"}),$("#feature_prev").css({display:"none"})):($("#feature_next").css({display:"block"}),$("#feature_prev").css({display:"block"})),$(".featur_pro").css({left:"0px"}),$("#feature_next").click(function(e){n>=t.length-4||(n++,$(".featur_pro").animate({left:-215*n},300))}),$("#feature_prev").click(function(e){n&&(n--,$(".featur_pro").animate({left:-215*n},300))})},error:function(e){}})}$(".mealBtnWrap").on("click",".mealDemand",function(){var e=$(".setmeal").attr("packageIndex"),t=s[e],a=o;$.require({path:5,meal:t,product:a,qty:1,getColl:l,requireGtag:requireGtag})});var u=null;function d(){for(var e=$(".pro-r .singleMeal .liaoCheng span"),t=Number($("#productNumber").val()),a="",i=0;i<e.length;i++){var r=Number(e.eq(i).attr("qty")),n=Number(e.eq(i).attr("qtyEnd"));r<=t&&t<=n&&(a=e.eq(i).attr("index"))}""!=a?e.eq(a).addClass("active").siblings().removeClass("active"):""==a&&e.removeClass("active")}function p(){if(!$(".liaoCheng .active").attr("index"))return $("#liao").html('<span>本店价</span><p class="we">￥ <span>'+priceInit(Number(n.ourPrice))+"</span></p>"),!1;var e=Number($("#productNumber").val()),t=Number($(".liaoCheng .active").attr("oldPrice"))||n.ourPrice,a=((Number($(".liaoCheng .active").attr("newPrice"))||n.ourPrice)*e).toFixed(2),i=((t*e).toFixed(2)-a).toFixed(2);$("#liao").html('<span>疗程价</span><p class="he">￥ <span>'+a+'</span></p><p class="you">优惠<span>￥'+i+"</span></p>")}$.ajax({url:"/getSingleComboByProductId",type:"POST",dataType:"json",data:{productID:r},success:function(e){if(!e.success||e.data.length<=0)return $(".singleMeal").css({display:"none"}),!1;e.data[0];$.ajax({url:"/getComboDetailByPackageId",type:"POST",dataType:"json",data:{packageID:e.data[0].packageID},success:function(e){if(!e.success||e.data.length<=0)return $(".singleMeal").css({display:"none"}),!1;$(".singleMeal").css({display:"block"}),u=e.data;for(var t="",a=0;a<u.length;a++)t+='<span packageID="'+u[a].packageID+'" index="'+a+'" qty="'+u[a].qty+'" qtyEnd="'+u[a].qtyEnd+'" oldPrice="'+u[a].ourPrice+'" newPrice="'+u[a].price+'">'+(u[a].detailpackageName?u[a].detailpackageName:"")+"</span>";$(".singleMeal .liaoCheng").html(t),d(),p()},error:function(e){console.log(e)}})},error:function(e){console.log(e)}}),$(".singleMeal").off("click",".liaoCheng span").on("click",".liaoCheng span",function(){var e=Number($(this).attr("qty"));e=$(this).hasClass("active")?($(this).removeClass("active").siblings().removeClass("active"),1):($(this).addClass("active").siblings().removeClass("active"),Number($(this).attr("qty"))),$("#productNumber").val(e),d(),p()})});