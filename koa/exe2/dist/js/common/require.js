function getdefault(e,a){$.ajax({url:$.getGlobalVal().webRoot+"/vipSearchByID",type:"POST",dataType:"json",data:{id:e},success:function(e){$(".toLogin a").html("欢迎您"+e.memberName+"，以下为您的默认收货地址信息。"),$(":radio[name='sex'][value='"+e.sex+"']").prop("checked","checked"),$("#carId").val(e.cardID)}}),$.ajax({url:$.getGlobalVal().webRoot+"/delivery/getDeliveryAddress?memberId="+e,type:"POST",dataType:"json",data:{},success:function(e){if(0<e.length){var a=e[0];getProv(a.districtID,"city"),getProv(a.city,"county"),$("#userName").val(a.contactMan),$("#phone").val(a.mobile),$("#province").val(a.districtID),$("#city").val(a.city),$("#county").val(a.county);var t=$("#province option:selected").text()+$("#city option:selected").text()+$("#county option:selected").text(),i=a.address;-1!=i.indexOf(t)&&(i=i.replace(t,"")),$("#addressName").val(i)}}})}function getProv(e,i){$.ajax({url:$.getGlobalVal().webRoot+"/selectArea",type:"POST",dataType:"json",data:{parentId:e},async:!1}).done(function(e){for(var a='<option value="">请选择</option>',t=0;t<e.length;t++)a+='<option value="'+e[t].id+'">'+e[t].name+"</option>";$("#"+i).html(a)})}function getUser(){for(var e=document.cookie.split("; "),a=0;a<e.length;a++){var t=e[a].split("=");if("memberId"==t[0]&&"null"!=t[1])return unescape(t[1])}}function priceInit(e){var a=String(e).indexOf(".")+1,t=String(e).length-a;return-1==String(e).indexOf(".")?e+".00":t<=1?e+"0":e}function demandCancel(e){var n=e.memberID||"",l=e.commodityType||"",d=e.productID||"",o=e.packageNo||"";layui.use("layer",function(){var s=layui.layer;s.open({type:1,title:"关闭原因",content:'<div id="cancelLayer"><div class="cancelTips">如果您无法提交登记，建议您使用谷歌浏览器试试，您也可以直接拔打药师咨询电话<span>400-9309-990</span></div><div class="cancelContent">\t\t  \t<label class="radio_label" for="cancel1"><input checked="" id="cancel1" value="价格偏贵" name="cancelType" type="radio" autocomplete="off"><span class="radio_frame"><i></i></span><span>价格偏贵</span></label>\t\t  \t<label class="radio_label" for="cancel2"><input id="cancel2" value="需求登记无法提交" name="cancelType" type="radio" autocomplete="off"><span class="radio_frame"><i></i></span><span>需求登记无法提交</span></label>\t\t  \t<label class="radio_label" for="cancel3"><input id="cancel3" value="担心假货" name="cancelType" type="radio" autocomplete="off"><span class="radio_frame"><i></i></span><span>担心假货</span></label>\t\t  \t<label class="radio_label" for="cancel4"><input id="cancel4" value="随便看看" name="cancelType" type="radio" autocomplete="off"><span class="radio_frame"><i></i></span><span>随便看看</span></label>\t\t  \t<label class="radio_label otherReason" for="cancel5"><input id="cancel5" value="其他原因" name="cancelType" type="radio" autocomplete="off"><span class="radio_frame"><i></i></span><span>其他原因</span></label><textarea placeholder="请输入原因" id="otherMsg"></textarea></div></div>',id:"cancelAlertID",area:"400px",skin:"cancelAlert",btn:["提交原因"],yes:function(a,e){var t=e.find('input[name="cancelType"]:checked').val();t="其他原因"==t?t+"："+e.find("#otherMsg").val():t;var i={memberID:n,commodityType:l,causeoffailure:t,sysNo:"pc"};d&&""!=d&&(i.productID=d),o&&""!=o&&(i.packageNo=o),$.ajax({url:$.getGlobalVal().webRoot+"/require/addfailedRequire",type:"POST",dataType:"json",data:i,success:function(e){s.msg(e.msg),s.close(a)},error:function(e){console.log(e),s.msg("提交失败"),s.close(a)}})}})}),$("body").off("change",'input[name="cancelType"]').on("change",'input[name="cancelType"]',function(){"其他原因"==$(this).val()?$("#otherMsg").css("display","inline-block").val(""):$("#otherMsg").css("display","none").val("")})}function yesAdd(e){layui.use("layer",function(){layui.layer.open({type:0,title:"需求登记",area:"400px",skin:"yesAdd",id:"yesAddId",content:'<div id="yesAddLayer"><p class="yesCon">您的信息已提交，药师看到后会立即电话回拨为您服务，请留意来电！</p><p class="yesPhone">如紧急，请拨打<span>400-9309-990</span>咨询阿康健康专业药师</P><p class="yesTips">温馨提示：晚上11点后提交的需求登记将在次日早上给您回拨</p></div>'})})}$(function(){jQuery.extend({require:function(o){var l={};if(0==o.path)(l=o.product).photodURL=l.photoURL?l.photoURL:l.photodURL;else if(1==o.path)(l=o.product).photodURL=l.defaultPhoto;else if(2==o.path)(l=o.product).photodURL=l.productPhotos[0]?l.productPhotos[0].photoURL:"./static/images/ak_300x300.jpg";else if(3==o.path){l=o.product.product;o.product}else if(4==o.path){l=o.product.product;var e=o.product}else if(5==o.path)var a=o.product,c=o.meal;var t=o.qty||1,i=o.getColl||function(){},p=o.requireGtag||function(){},r=o.listReload||function(){},u=l.productID?l.productID:"",v=!0,s="";if(5==o.path){p({title:"点击套餐需求登记",content:{event_category:"点击套餐需求登记的套餐id："+c.packageID}});for(var n="",d=0;d<a.length;d++)n+='<div class="item"><div class="mpInfo" style="width:70%;"><img src="'+(a[d].photodURL?a[d].photodURL:"./static/images/ak_200x200.jpg")+'" /><div class="mpText"><p class="mpName"><i class="'+$.imgType(a[d].prescriptionType)+'"></i>'+a[d].productName+'</p><p class="mpSpec"><span>'+a[d].spec+'<span></p></div></div><div class="mpQty" style="width:15%;"><p>'+a[d].qty+'</p></div><div class="mpPrice" style="width:15%;"><p>'+priceInit(Number(a[d].price))+'</p></div><b class="clear"></b></div>';s='<p class="tips">提交登记后，阿康门店药师将在15分钟内致电与您确认，请您保持电话通畅哦。注：套餐商品的商品种类和数量为固定组合，不可修改。</p><div class="mealWrap"><input type="hidden" name="packageID" value="'+c.packageID+'"><div class="mealTable"><div class="mealHead"><span style="width:70%;text-align:left;text-indent:20px;">商品信息</span><span style="width:15%;">数量</span><span style="width:15%;">原单价</span><i class="clear"></i></div><div class="mealBody">'+n+'</div>\t</div><div class="mealInfo"><div style="width:240px;"><span class="key">套餐数：</span><div class="value"><a href="javascript:void(0);" class="reduce"></a><input type="text" name="qty" id="demandNum" value="'+t+'" /><a href="javascript:void(0);" class="add"></a></div></div><div style="width:160px;"><span class="key">套餐价：</span><div class="value" style="font-size:16px;color:#e00000;">'+priceInit(c.afterBenefitCost)+'</div></div><div style="width:160px;"><span class="key">原总价：</span><div class="value">'+priceInit(c.oldCost)+'</div></div><i class="clear"></i></div></div>'}else p({title:"点击需求登记",content:{event_category:"点击需求登记的商品id："+u}}),s='<p class="tips"> 温馨提示：提交登记后，阿康门店药师将在15分钟内致电与您确认，请您保持电话通畅哦。</p><div class="productInfo"><div id="productSend"><input type="hidden" name="productID" value="'+l.productID+'"><input type="hidden" name="productName" value="'+l.productName+'"><input type="hidden" name="productCode" value="'+l.productCode+'"></div><a href="javascript:void(0)"><img src="'+(l.photodURL?l.photodURL:"./static/images/ak_200x200.jpg")+'"></a><div class="proInforShow"><p class="p-text">'+l.productName+'</p><div class="p-list"><span>规格：</span><div class="p-gui">'+l.spec+'</div></div><div class="p-list" id="alLiaoMoney"><span>价格：</span><div class="p-pri">￥ <span>'+priceInit(Number(l.ourPrice))+'</span></div></div><div class="p-list"><span>数量：</span><div class="p-num"><a href="javascript:void(0)" class="reduce"></a><input type="text" name="qty" id="demandNum" value="'+t+'" /><a href="javascript:void(0)" class="add"></a></div></div><div class="p-list singleMeal" style="margin-top:3px;display:none;"><span style="line-height: 30px;">疗程装：</span><div class="liaoCheng"></div></div></div></div>';var m='<div id="requireAlert333" class="alertWrap"><div style="height:650px;" class="alertContent"><div class="alertTop"><span>需求登记</span><b>X</b><i class="clear"></i></div><form id="demandAlert" enctype="multipart/form-data" action="javascript: void(0);"><div id="output" style="display: none;"></div><input type="hidden" name="memberID"><input type="hidden" name="sysNo" value="pc">'+s+'<div class="toLogin"><a id="loginShow" href="javascript:void(0)">登录阿康会员，可帮助您快速提交需求！</a></div><div class="user-wrap"><div class="user-item" style="width: 50%;"><span class="key">姓名：</span><div><input style="width:177px;" type="text" name="realName" id="userName" class="userName" placeholder="请输入姓名"></div></div><div class="user-item" style="width: 50%;"><span class="key">手机：</span><div><input type="text" id="phone" name="phone" class="phone" style="width: 223px;" placeholder="请输入手机"></div></div><div class="user-item"><span>地区：</span><div><select id="province" class="" name=""><option value="">请选择</option></select><select name="" id="city"><option value="">请选择</option></select><select name="" id="county"><option value="">请选择</option></select></div></div><div class="user-item"><span>详细地址：</span><div><input type="text" id="addressName" class="addressName" style="width: 559px;" placeholder="请输入详细地址"><input type="hidden" name="DeliveryAddress"></div></div><div class="left" style="width: 38%;"><div class="user-item" style="width: 100%"><span>年龄：</span><div><input id="age" type="text" name="age" placeholder="请输入年龄"></div></div><div class="user-item" style="width: 100%"><span>身份证号：</span><div><input id="carId" type="text" name="carId" placeholder="请输入身份证号"></div></div><div class="user-item"><span>性别：</span><div><label><input type="radio" name="sex" value="1" checked> 男</label><label><input type="radio" name="sex" value="2"> 女</label></div></div><div class="user-item"><span>门店递送：</span><div><input value="1" type="checkbox" checked disabled><input name="isStore" value="1" type="hidden"></div></div><div class="user-item docphone"><p>如紧急，请咨询药师 <span>400-9309-990</span></p></div></div><div class="left" style="width:31%;"><div class="user-item"><span style="width:50px;">留言：</span><div><textarea name="remark" id="demandRemark" placeholder="请留言您的要求"></textarea></div></div></div><div class="left" style="width:31%;"><div class="isPres"><span class="active">有处方</span><span>无处方</span></div><div class="user-item"><div id="upload"><span>上传处方笺图片</span><img src=""><input id="file" type="file" accept="image/jpeg,image/jpg,image/png"><input type="hidden" name="imgstr"></div></div></div></div><div class="demand-button"><button type="submit" class="demand-submit">提交需求</button><button class="demand-cancel">返回</button></div></form></div></div>';$("body").append(m),getProv(null,"province");var y=getUser();y?getdefault(y,e):$(".toLogin a").html("登录阿康会员，可帮助您快速提交需求！"),$("body").off("click","#loginShow").on("click","#loginShow",function(e){if(e.preventDefault(),getUser())return!1;var a={};return i&&(a.getColl=i),a.getdefault=getdefault,$.loginAlert(a),!1}),$("body").off("click","#demandAlert .reduce").on("click","#demandAlert .reduce",function(){var e=$(this).next().val();if(!/^[0-9]*$/.test(e))return $.tips("请输入数字",2),$(this).next().val(1),!1;--e<1&&(e=1,$.tips("数量至少为1",-1)),$(this).next().val(e),h(),g()}),$("body").off("click","#demandAlert .add").on("click","#demandAlert .add",function(){var e=$.trim($(this).prev().val());if(!/^[0-9]*$/.test(e))return $.tips("请输入数字",2),$(this).prev().val(1),!1;e++,$(this).prev().val(e),h(),g()}),$("body").off("blur","#demandAlert #demandNum").on("blur","#demandAlert #demandNum",function(){var e=$.trim($(this).val());/^[0-9]*$/.test(e)||($.tips("请输入数字",2),e=1),$(this).val(e),h(),g()}),$("body").off("change","#province").on("change","#province",function(){if(""==$(this).val())return $("#city").html('<option value="">请选择</option>'),$("#county").html('<option value="">请选择</option>'),!1;$("#city").html('<option value="">请选择</option>'),$("#county").html('<option value="">请选择</option>'),getProv(Number($(this).val()),"city")}),$("body").off("change","#city").on("change","#city",function(){if(""==$(this).val())return $("#county").html('<option value="">请选择</option>'),!1;$("#county").html('<option value="">请选择</option>'),getProv(Number($(this).val()),"county")}),$("body").off("click",".isPres span").on("click",".isPres span",function(){$(this).addClass("active").siblings().removeClass("active"),1==$(this).index()?$("#upload").css("display","none"):$("#upload").css("display","block")}),$("body").off("click","#upload span").on("click","#upload span",function(){$(this).siblings("#file").click()}),$("body").off("click","#upload img").on("click","#upload img",function(){$(this).siblings("#file").click()}),$("body").off("change","#file").on("change","#file",function(){var a=$(this),e=this.files[0];if(window.FileReader){var t=new FileReader;t.readAsDataURL(e),t.onloadend=function(e){a.parent().find("img").prop("src",e.target.result),a.parent().find("span").css({display:"none"}),$('input[name="imgstr"]').val(e.target.result)}}}),$("body").off("submit","#demandAlert").on("submit","#demandAlert",function(){if(!v)return!1;var e="请选择"==$("#province option:selected").text()?"":$("#province option:selected").text(),a="请选择"==$("#city option:selected").text()?"":$("#city option:selected").text(),t="请选择"==$("#county option:selected").text()?"":$("#county option:selected").text(),i=$.trim($("#addressName").val()),s=e+a+t,n=-1==i.indexOf(s)?s+i:i;$('input[name="DeliveryAddress"]').val(n);var l=getUser();l=l||"",$('input[name="memberID"]').val(l);var d={target:"#output",beforeSubmit:function(e,a,t){var i=a[0];return/^[0-9]*$/.test(i.qty.value)?i.qty.value<1?($.tips("数量至少为1",-1),$("#demandNum").val(1),!1):""==i.realName.value?($.tips("姓名不能为空",2),!1):""==i.phone.value?($.tips("手机号不能为空",2),!1):/^1[3|4|5|6|7|8|9][0-9]{9}$/.test(i.phone.value)?""==i.age.value||/^[1-9]\d*$/.test(i.age.value)?""==i.carId.value||/(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X)$)/.test(i.carId.value)?void(v=!1):($.tips("身份证号格式不正确",2),!1):($.tips("年龄请输入正整数",2),!1):($.tips("手机格式不正确",2),!1):($.tips("数量请输入数字",2),$("#demandNum").val(1),!1)},success:function(e){5==o.path?p({title:"提交套餐需求登记",content:{event_category:"提交套餐需求登记的套餐id："+c.packageID,event_label:"提交结果："+e.msg}}):p({title:"提交需求登记",content:{event_category:"商品id："+u,event_label:"提交结果："+e.msg}}),$("body").find("#requireAlert333").remove(),v=!1,e.success?yesAdd(e.msg):$.finishTips("需求登记提示",e.msg),r(1)},url:$.getGlobalVal().webRoot+"/require/addRequire",type:"post",dataType:"json",clearForm:!0,resetForm:!0,timeout:3e3};$("#demandAlert").ajaxSubmit(d)}),$("body").off("click","#demandAlert .demand-cancel").on("click","#demandAlert .demand-cancel",function(){$("body").find("#requireAlert333").remove();var e=getUser();return demandCancel({memberID:e=e||"",commodityType:c?2:1,productID:u,packageNo:c?c.packageID:""}),!1}),$("body").off("click","#requireAlert333 b").on("click","#requireAlert333 b",function(){$("body").find("#requireAlert333").remove();var e=getUser();demandCancel({memberID:e=e||"",commodityType:c?2:1,productID:u,packageNo:c?c.packageID:""})});var f=null;function h(){for(var e=$("#requireAlert333 .singleMeal .liaoCheng span"),a=Number($("#demandNum").val()),t="",i=0;i<e.length;i++){var s=Number(e.eq(i).attr("qty")),n=Number(e.eq(i).attr("qtyEnd"));s<=a&&a<=n&&(t=e.eq(i).attr("index"))}""!=t?e.eq(t).addClass("active").siblings().removeClass("active"):""==t&&e.removeClass("active")}function g(){var e=$("#requireAlert333 .liaoCheng .active").attr("index"),a=$("#requireAlert333 .liaoCheng .active").attr("packageID");if(!e)return $("#alLiaoMoney").html('<span>价格：</span><p class="p-pri">￥ <span>'+priceInit(Number(l.ourPrice))+"</span></p>"),$("#productSend").html('<input type="hidden" name="productID" value="'+l.productID+'"><input type="hidden" name="productName" value="'+l.productName+'"><input type="hidden" name="productCode" value="'+l.productCode+'">'),!1;$("#productSend").html('<input type="hidden" name="packageID" value="'+a+'">');var t=Number($("#demandNum").val()),i=Number($("#requireAlert333 .liaoCheng .active").attr("oldPrice"))||productDetail.ourPrice,s=((Number($("#requireAlert333 .liaoCheng .active").attr("newPrice"))||productDetail.ourPrice)*t).toFixed(2),n=((i*t).toFixed(2)-s).toFixed(2);$("#alLiaoMoney").html('<span>疗程价：</span><div><div class="he p-pri" style="float: left;">￥ <span>'+s+'</span></div><div style="float:left;font-size:14px;color:#a7a7a7;margin-left:20px;">优惠<span>￥'+n+"</span></div></div>")}c||$.ajax({url:$.getGlobalVal().webRoot+"/getSingleComboByProductId",type:"POST",dataType:"json",data:{productID:u},async:!1,success:function(e){if(0!=o.path)return!1;if(!e.success||e.data.length<=0)return $("#requireAlert333 .singleMeal").css({display:"none"}),!1;e.data[0];$.ajax({url:$.getGlobalVal().webRoot+"/getComboDetailByPackageId",type:"POST",dataType:"json",data:{packageID:e.data[0].packageID},async:!1,success:function(e){if(!e.success||e.data.length<=0)return $("#requireAlert333 .singleMeal").css({display:"none"}),!1;$("#requireAlert333 .singleMeal").css({display:"block"}),f=e.data;for(var a="",t=0;t<f.length;t++)a+='<span packageID="'+f[t].packageID+'" index="'+t+'" qty="'+f[t].qty+'" qtyEnd="'+f[t].qtyEnd+'" oldPrice="'+f[t].ourPrice+'" newPrice="'+f[t].price+'">'+(f[t].detailpackageName?f[t].detailpackageName:"")+"</span>";$("#requireAlert333 .singleMeal .liaoCheng").html(a),h(),g()},error:function(e){console.log(e)}})},error:function(e){console.log(e)}}),$("#requireAlert333 .singleMeal").off("click",".liaoCheng span").on("click",".liaoCheng span",function(){var e=Number($(this).attr("qty"));e=$(this).hasClass("active")?($(this).removeClass("active").siblings().removeClass("active"),1):($(this).addClass("active").siblings().removeClass("active"),Number($(this).attr("qty"))),$("#demandNum").val(e),g()})}})});