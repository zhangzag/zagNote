function getQueryString(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"),a=window.location.search.substr(1).match(e);return null!=a?decodeURI(a[2]):null}function imgSrcInit(t){return""===t?"/static/images/ak_200x200.jpg":-1==t.indexOf("http://192.168.2.250:8081")?"http://192.168.2.250:8081"+t:t}function getUser(){for(var t=document.cookie.split("; "),e=0;e<t.length;e++){var a=t[e].split("=");if("memberId"==a[0]&&"null"!=a[1])return unescape(a[1])}}function tips(t,e){layui.use("layer",function(){layer.msg(t,{icon:e,time:1e3})})}$(function(){var t=getQueryString("packageID"),e=getQueryString("productId"),a=getQueryString("packageIndex");$.ajax({url:$.getGlobalVal().webRoot+"/getComboByProductId",type:"POST",dataType:"json",data:{productID:e},success:function(t){if(!t.success||null===t.data)return!1;var e=t.data[a];$(".meal-r .meal-info>img").attr("src",imgSrcInit(e.photodURL)),$(".meal-r .meal-text span").html(e.packageName),$(".meal-r .meal-pri .payPri span").html(e.afterBenefitCost),$(".meal-r .meal-pri .oldPri").html("￥"+e.oldCost),$(".crumbs span").html(e.packageName),$.ajax({url:$.getGlobalVal().webRoot+"/getComboDetailByPackageId",type:"POST",dataType:"json",data:{packageID:e.packageID},success:function(t){for(var e=t.data,a="",r=0,o=0;o<e.length;o++){r+=e[o].qty;var l=e[o].photodURL?e[o].photodURL:"/static/images/ak_200x200.jpg";a+='<div class="meal-item"><a href="/products/'+e[o].productID+'.html"><img src="'+l+'"></a><div class="meal-info"><h6><i class="'+$.imgType(e[o].prescriptionType)+'"></i><a href="/products/'+e[o].productID+'.html">'+e[o].productName+"</a></h6><p>数量："+e[o].qty+"</p><p>单价："+e[o].price+"</p></div></div>"}$(".meal-l .meal-product").html(a),$(".meal-l h3 .productType").html(e.length),$(".meal-l h3 .qty").html(r)},error:function(t){console.log(t)}})}});var r=null;$(".buyBtn").click(function(){if(!getUser())return layui.use("layer",function(){var t=layui.layer;r=t.open({type:1,title:"会员登录",content:$("#loginAlert"),area:"500px"})}),!1;window.location.href="/submitOrder.html?productId="+e+"&packageID="+t+"&packageIndex="+a}),$("#loginAlert button").click(function(){var t=$.trim($("#loginUser").val()),e=$.trim($("#loginPass").val());if(!/^1[3|4|5|6|7|8|9][0-9]{9}$/.test(t))return tips("手机格式不正确，请重新输入",2),!1;$.ajax({url:$.getGlobalVal().webRoot+"/login",type:"POST",dataType:"json",data:{username:t,password:e}}).done(function(t){!0===t.success&&($.cookie("memberId",JSON.stringify(t.memberID),{expires:7,path:"/"}),layer.close(r),tips("欢迎来到阿康健康！",1),$("#top").load("/module/common/top.html?n="+Math.random().toFixed(3)),$.authorization(t.memberID))})})});