function btnsCancelFilter(t){return 4!=t&&5!=t&&6!=t&&7!=t&&8!=t&&'<a class="btn_cancel_order" href="javascript:void(0);">取消订单</a>'}function btnsPayFilter(t){return 1==t||9==t?'<button class="btn_primary bp_green large">支付</button>':"false"}function btnsConfirmFilter(t){return 4==t||3==t?'<button class="btn_primary bp_green large btn_order_confirm">确认收货</button>':"false"}function filterStatus(t){return 1==t||9==t?"待付款":3==t||2==t?"待发货":4==t?"待收货":5==t||6==t||7==t?"已送达":8==t?"已取消":void 0}$(function(){$.getGlobalVal().webRoot,$.getGlobalVal().memberId,$.getGlobalVal().webOrigin;var r=!1,i=$.getQueryString("ori");$.ajax({url:"/order/getOrderInfoByOrderId",data:{orderID:i}}).done(function(a){if(!a.success||!a.data)return layui.use("layer",function(){var t=layui.layer;t.open({type:1,title:"提示",offset:"auto",id:"layerAlert"+100*Math.random().toFixed(2),content:'<div style="padding: 20px 100px;">'+a.msg+"</div>",btn:"关闭",btnAlign:"c",shade:.3,time:1500,yes:function(){t.closeAll()}})}),!1;$(".order_num").text(a.data.orderCode),$(".order_date").text(a.data.orderDate),$(".order_pay").text($.payType(a.data.payType)),$(".order_price").text($.priceFilter(a.data.factAmt)),$(".order_statu").text($.orderStatuFilter(a.data.orderStatus)),$(".logistics_user").text(a.data.contactMan||""),$(".logistics_phone").text(a.data.cellPhone||""),$(".logistics_address").text(a.data.deliveryAddress||""),$(".logistics_company").text(a.data.deliveryName||""),$(".logistics_num").text(a.data.logisticsNumber||""),4!=a.data.orderStatus&&5!=a.data.orderStatus&&6!=a.data.orderStatus&&7!=a.data.orderStatus||$(".logistics_num").after('<button class="btn_primary plain btn_express" data-locod="'+(a.data.logistics?a.data.logistics.logisticsCode:"")+'" data-lono="'+(a.data.logisticsNumber?a.data.logisticsNumber:"")+'" data-sta="'+(a.data.orderStatus?a.data.orderStatus:"")+'" data-cod="'+(a.data.logistics?a.data.logistics.logisticsName:"")+'" data-lnum="'+(a.data.logisticsNumber?a.data.logisticsNumber:"")+'" data-tel="'+(a.data.logistics?a.data.logistics.phone:"")+'"  >查看物流</button>'),$(".block_area_con .remarks").val(a.data.orderRemark);for(var t=0;t<a.data.orderDetails.length;t++)$(".list_lists_small").append('<div class="item"><table class="akdefult_table" cellspacing="0" cellpadding="0" border="0"><col width="364" align="center" /><col width="128" align="center" /><col width="190" align="center" /><col width="80" align="center" /><col width="165" align="center" /><tbody><tr><td></td><td class="tc"></td><td class="tc"></td><td class="tc"></td><td class="tc"></td></tr></tbody></table></div>'),$(".list_lists_small .item").eq(t).find("tbody tr td").eq(0).html('<div class="i_info"><div><img class="lazy" data-original="'+a.data.orderDetails[t].productUrl+'?70*70" alt="'+a.data.orderDetails[t].productName+'"></div><p>'+$.iconProImg(a.data.orderDetails[t].prescriptionType)+a.data.orderDetails[t].productName+"</p><span>规格："+a.data.orderDetails[t].productProperty+"</span></div>"),$(".list_lists_small .item").eq(t).find("tbody tr td").eq(1).html("<div>"+a.data.orderDetails[t].productID+"</div>"),$(".list_lists_small .item").eq(t).find("tbody tr td").eq(2).html('<div class="prices"><span>'+$.priceFilter(a.data.orderDetails[t].marketPrice)+"</span><strong>"+$.priceFilter(a.data.orderDetails[t].price)+"</strong></div>"),$(".list_lists_small .item").eq(t).find("tbody tr td").eq(3).html("<div>"+a.data.orderDetails[t].qty+"</div>"),$(".list_lists_small .item").eq(t).find("tbody tr td").eq(4).html("<div>"+$.priceFilter(a.data.orderDetails[t].amt)+"</div>");$(".count_pro").text($.priceFilter(a.data.ordtotalAmt)),$(".count_charges").text($.priceFilter(a.data.chargeAmtDiscount)),$(".count_discount").text("- "+$.priceFilter((100*a.data.productDiscount+100*a.data.manualDeduction)/100)),$(".count_all").text($.priceFilter(a.data.factAmt)),$(".btns_conut").append(btnsCancelFilter(a.data.orderStatus)),$(".btns_conut").append(btnsPayFilter(a.data.orderStatus)),$(".btns_conut").append(btnsConfirmFilter(a.data.orderStatus)),lazyLoad({imgSrc:"/static/images/ak_200x200.jpg"})}),$(".btns_conut").on("click",".btn_cancel_order",function(){layui.use("layer",function(){var e=layui.layer;r||(r=!0,e.confirm("确定要取消订单？",{btn:["确定","取消"],btnAlign:"c"},function(t,a){$.ajax({url:"/order/updateOrderStatusByCancel",data:{orderId:i}}).done(function(t){t.success&&(e.msg(t.msg,{time:2e3}),setTimeout(function(){window.location.href="/module/member/order.html"},2e3))}).fail(function(){console.log("error")}).always(function(){r=!1})},function(t){console.log("取消"),r=!1}))})}),$(".btns_conut").on("click",".btn_order_confirm",function(){layui.use("layer",function(){var e=layui.layer;r||(r=!0,e.confirm("确定执行此操作？",{btn:["确定","取消"],btnAlign:"c"},function(t,a){e.close(t),$.ajax({url:"/order/updateOrderStatusByConfirmReceipt",data:{orderId:i}}).done(function(t){e.msg(t.msg,{time:2e3}),t.success&&setTimeout(function(){window.location.reload()},2e3)})},function(t){r=!1}))})}),$(".block_area_con").on("click",".btn_express",function(t){t.preventDefault(),t.stopPropagation();var a=$(this).attr("data-lono"),e=$(this).attr("data-locod"),r=filterStatus($(this).attr("data-sta")),i=$(this).attr("data-cod"),d=$(this).attr("data-lnum"),o=$(this).attr("data-tel");$.ajax({url:"/delivery/getLogistics",data:{logisticsNo:a,logisticsCode:e}}).done(function(t){if(t.success){$(".exp_line_status").text(r),$(".exp_line_company").text(i),$(".exp_line_num").text(d),$(".exp_line_tel").text(o),0===t.data.length&&$(".exp_layer .exp_detail .exp_detail_right").append('<p class="new_detail"><span>暂无物流信息</span></p>');for(var a=t.data.length-1;0<a;a--)$(".exp_layer .exp_detail .exp_detail_right").append('<p class="'+(a==t.data.length-1?"new_detail":"")+'"><span>【'+t.data[a].address+"】"+t.data[a].remark+"</span><span>"+t.data[a].time+"</span></p>")}else layui.use("layer",function(){layui.layer.msg("物流信息查询失败，"+t.msg)});$(".exp_layer").stop(!0,!0).fadeIn(300)})}),$(".exp_layer").click(function(t){t.stopPropagation()}),$(".exp_layer_in .exp_head>i").click(function(t){t.stopPropagation(),$(".exp_layer").stop(!0,!0).fadeOut(300)}),$("body").click(function(t){t.stopPropagation(),$(".exp_layer").stop(!0,!0).fadeOut(300)})});