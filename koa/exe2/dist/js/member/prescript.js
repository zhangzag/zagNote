function formSubmit(){return!1}$(function(){var n=$.getGlobalVal().webRoot,e=$.getGlobalVal().memberId,i=($.getGlobalVal().webOrigin,!1);$('input[name="memberID"]').val(e),$(".prescript_img").click(function(e){$("#add_pre_file").click()}),$(".btn_addrp").click(function(e){var t=$(".addrp_cols .addrp_col").length,a='\t\t\t<div class="addrp_col">\t\t\t\t<span>'+(t+1)+'</span>\t\t\t\t<input class="rp_col_name" placeholder="请输入药品名称" name="prescriptionDetails['+t+'].medicine" type="text" autocomplete="off">\t\t\t\t<input class="rp_col_spec" placeholder="请输入药品规格" name="prescriptionDetails['+t+'].spec" type="text" autocomplete="off">\t\t\t\t<button class="btn_deleterp">删除</button>\t\t\t</div>';$(".addrp_cols").append(a)}),$(".addrp_cols").on("click",".btn_deleterp",function(e){e.preventDefault(),$(this).parents(".addrp_col").remove();for(var t=0;t<$(".addrp_col").length;t++)$(".addrp_col").eq(t).find("span").html(t+1),$(".addrp_col").eq(t).find(".rp_col_name").attr("name","prescriptionDetails["+t+"].medicine"),$(".addrp_col").eq(t).find(".rp_col_spec").attr("name","prescriptionDetails["+t+"].spec")}),$(".form_con").submit(function(e){if(i)return!1;layui.use("layer",function(){var r=layui.layer;r.confirm("确定提交？",{btn:["确定","取消"],id:"layerConfirm"+100*Math.random().toFixed(2)},function(e,t){var a={url:n+"/prescription/addPrescription",type:"post",beforeSubmit:function(){if(!$("#agree").is(":checked"))return r.msg("请阅读并同意处方购买协议!",{time:3e3}),r.close(e),i=!1},success:function(e){r.open({title:"提示",btnAlign:"c",content:e.msg}),i=!1},target:"#output",dataType:"json",clearForm:i=!0,resetForm:!0,timeout:3e3};return $(".form_con").ajaxForm(a),$(".form_con").ajaxSubmit(a),r.close(e),!1},function(e){r.closeAll()})})}),$("#add_pre_file").change(function(t){var a=t.target.files[0]||t.dataTransfer.files,e=new FileReader,r=new Image;if(e.readAsDataURL(a),e.onload=function(){r.src=this.result,r.id="uploadImg"},2097152<=a.size){try{var n=document.createElement("canvas");n.getContext("2d")}catch(l){return alert("您的浏览器过于老旧，请使用新版浏览器！"),!1}var i=n.getContext("2d");r.onload=function(e){n.width=640,n.height=r.height/r.width*640,i.drawImage(r,0,0,n.width,n.height);var t=n.toDataURL(a.type,.6);$("#hiddenImg").val(t.split(",")[1]),$(".prescript_img").html(""),$(".prescript_img").append('<img src="'+t+'" />'),e.target.value=null}}else r.onload=function(e){$("#hiddenImg").val(r.src.split(",")[1]),$(".prescript_img").html(""),$(".prescript_img").append(r),t.target.value=null}}),$(".agree_block>a").click(function(e){$(".agree_layer").stop(!0,!0).fadeIn(300)}),$(".agree_layer_head h3>i").click(function(e){$(".agree_layer").stop(!0,!0).fadeOut(300)})});