function imgSrcInit(t){return t}function requireGtag(t){var e=t.title||"提交需求登记",i=t.content||{};gtag("event",e,i)}$(function(){$(".edit-w .edit-t").click(function(){if("block"==$(".nothing").css("display"))return!1;$(this).css({display:"none"}).siblings().css({display:"inline-block"}),$(".list-tab .info label").css({display:"inline-block"}),$(".item .item-info label").css({display:"inline-block"}),$(".item .item-options p").css({display:"block"}).siblings().css({display:"none"})}),$(".list-tab .info input").click(function(){$(this).prop("checked")?($(this).next().html("✔"),$(".item .item-info input").prop("checked",!0),$(".item .item-info input").next().html("✔")):($(this).next().html(""),$(".item .item-info input").prop("checked",!1),$(".item .item-info input").next().html(""))}),$(".item-w").on("click",'.item input[type="checkbox"]',function(){var t=$(".item-w input[type='checkbox']").length,e=$(".item-w input[type='checkbox']:checked").length;$(this).prop("checked")?$(this).next().html("✔"):$(this).next().html(""),e==t?($(".list-tab .info input").prop("checked",!0),$(".list-tab .info label .checkSpan").html("✔")):($(".list-tab .info input").prop("checked",!1),$(".list-tab .info label .checkSpan").html(""))});var a=null;function i(t,c){$.ajax({url:"/favorite/getFavoriteList",type:"POST",dataType:"json",data:{memberId:$.getGlobalVal().memberId,limit:10,page:t},success:function(t){if(t.count,a=t.date,$(".collCount b").html(t.count),t.date.length<=0)return $(".nothing").css({display:"block"}),$(".item-w").css({display:"none"}),!1;$(".nothing").css({display:"none"}),$(".list-w .item-w").html("").css({display:"block"});for(var e=0;e<t.date.length;e++)if(null!=t.date[e].product){var i=0<t.date[e].product.reserves?"有货":"没货",n=null;n=0<t.date[e].product.reserves?1==t.date[e].product.prescriptionType?'<button class="demand-btn">需求登记</button>':'<button class="has-btn">立即购买</button>':'<button class="no-btn">补货中</button>';var l='<div class="item" collIndex="'+e+'" favoriteID="'+t.date[e].favoriteID+'" productId="'+t.date[e].product.productID+'" > \t\t\t\t\t\t\t<div class="item-info"> \t\t\t\t\t\t\t\t<label> \t\t\t\t\t\t\t\t\t<input type="checkbox" value="" /> \t\t\t\t\t\t\t\t\t<span class="checkSpan"></span> \t\t\t\t\t\t\t\t</label> \t\t\t\t\t\t\t\t<div class="info-img"><a href="/products/'+t.date[e].product.productID+'.html"><img src="'+imgSrcInit(t.date[e].product.photodURL)+'"></a></div> \t\t\t\t\t\t\t\t<div class="info-text"> \t\t\t\t\t\t\t\t\t<p class="name"> \t\t\t\t\t\t\t\t\t\t<i class="'+$.imgType(t.date[e].product.prescriptionType)+'"></i> \t\t\t\t\t\t\t\t\t\t'+t.date[e].product.productName+'\t\t\t\t\t\t\t\t\t</p> \t\t\t\t\t\t\t\t\t<p class="gui">'+t.date[e].product.spec+'</p> \t\t\t\t\t\t\t\t</div> \t\t\t\t\t\t\t</div> \t\t\t\t\t\t\t<div class="item-pri">'+t.date[e].product.ourPrice+'</div> \t\t\t\t\t\t\t<div class="item-ku">'+i+'</div> \t\t\t\t\t\t\t<div class="item-options"> \t\t\t\t\t\t\t\t<p class="cancelColl">取消收藏</p> \t\t\t\t\t\t\t\t'+n+" \t\t\t\t\t\t\t</div> \t\t\t\t\t\t</div>";$(".list-w .item-w").append(l)}else $(".list-w .item-w").append('<div class="item" collIndex="'+e+'" favoriteID="'+t.date[e].favoriteID+'" productId="'+t.date[e].productID+'" ><div class="item-info"><label><input type="checkbox" value="" /><span class="checkSpan"></span></label><div class="info-img"><img src="/static/images/ak_300x300.jpg"></div><div class="info-text"><p class="name">该商品不存在，或已下架！</p></div></div></div>');c&&($(".item .item-info label").css({display:"inline-block"}),$(".item .item-options p").css({display:"block"}).siblings().css({display:"none"}))},error:function(t){console.log(t)}})}function n(){$.ajax({url:"/favorite/getFavoriteList",type:"POST",dataType:"json",data:{memberId:$.getGlobalVal().memberId,limit:10,page:1},async:!1}).done(function(t){if(t.count<=0)return $(".nothing").css({display:"block"}),$(".item-w").css({display:"none"}),$(".edit-w .edit-t").css({display:"inline-block"}).siblings().css({display:"none"}),$(".list-tab .info label").css({display:"none"}),$(".item .item-info label").css({display:"none"}),$(".item .item-options p").css({display:"none"}).siblings().css({display:"block"}),$("#page").css({display:"none"}),$(".collCount b").html(t.count),!1;$("#page").css({display:"block"}),layui.use("laypage",function(){layui.laypage.render({elem:"page",count:t.count,limit:10,layout:["page","prev","next"],theme:"#a7a7a7",jump:function(t,e){"none"==$(".edit-w .edit-t").css("display")?i(t.curr,2):i(t.curr)}})})})}n();var t=null;$(".list-w .item-w").on("click",".item-options .cancelColl",function(){layui.use("layer",function(){t=layer.open({type:1,area:["306px","210px"],title:["提示","background-color: #E8E8E8;"],content:$("#sureAlert"),cancel:function(){}})}),$(this).parent().parent().addClass("cancelItem").siblings().removeClass("cancelItem")}),$("#sureAlert .sure").click(function(){layer.close(t),$.ajax({url:"/favorite/delFavoriteBymemberIdAndProId",type:"POST",dataType:"json",data:{memberId:$.getGlobalVal().memberId,productId:$(".item-w .cancelItem").attr("productId")},success:function(t){layui.use("layer",function(){layer.msg(t.msg,{time:1e3})}),n()},error:function(t){console.log(t)}})}),$("#sureAlert .can").click(function(){layer.close(t)});var l=null;$(".edit-w .edit-all").click(function(){if($(".item-w input[type='checkbox']:checked").length<=0)return layui.use("layer",function(){layer.msg("请至少选择一个需要删除的收藏商品！",{icon:2,time:1e3})}),!1;layui.use("layer",function(){l=layer.open({type:1,area:["306px","210px"],title:["提示","background-color: #E8E8E8;"],content:$("#allCollAlert"),cancel:function(){}})})}),$("#allCollAlert .sure").click(function(){layer.close(l);for(var t=$(".list-w .item-w .item"),e=[],i=0;i<t.length;i++)t.eq(i).find('input[type="checkbox"]').prop("checked")&&e.push(Number(t.eq(i).attr("favoriteID")));$.ajax({url:"/favorite/delFavorite",type:"POST",dataType:"json",data:JSON.stringify({memberId:$.getGlobalVal().memberId,favoriteIds:e}),contentType:"application/json;charset=UTF-8",success:function(t){layui.use("layer",function(){layer.msg(t.msg,{time:1e3})}),n(),$(".list-tab .info input").prop("checked",!1),$(".list-tab .info label .checkSpan").html("")},error:function(t){console.log(t)}})}),$("#allCollAlert .can").click(function(){layer.close(l)}),$(".edit-w .edit-com").click(function(){$(this).css({display:"none"}).prev().css({display:"none"}).prev().css({display:"block"}),$(".list-tab .info label").css({display:"none"}),$(".item .item-info label").css({display:"none"}),$(".item .item-options p").css({display:"none"}).siblings().css({display:"block"})}),$(".list-w .item-w").on("click",".demand-btn",function(){var t=$(this).parent().parent().attr("collIndex"),e=a[t];$.require({path:3,product:e,qty:1,requireGtag:requireGtag})}),$(".list-w .item-w").on("click",".has-btn",function(){var t=$(this).parent().parent().attr("productId");window.location.href="/submitOrder.html",$.cookie("order",JSON.stringify({orderType:1,productId:t,qty:Number(1)}),{path:"/",domain:".ak1ak1.com"})})});