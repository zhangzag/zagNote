$(function(){var c=null;function u(){$.ajax({url:"/delivery/getDeliveryAddress?memberId="+$.getGlobalVal().memberId,type:"GET",dataType:"json",data:{},success:function(e){if(e.length<=0)return $(".nothing").css({display:"block"}),$(".list-body").css({display:"none"}),!1;$(".nothing").css({display:"none"}),$(".list-body").html("").css({display:"block"});for(var a=0;a<e.length;a++){var t=""==e[a].mobile?e[a].telephone:e[a].mobile,l='<div class="item" addressID="'+e[a].addressID+'"><div class="consignee">'+e[a].contactMan+'</div><div class="address-name">'+e[a].address+'</div><div class="phone">'+t+'</div><div class="options"><span class="modifyAddress">修改</span><span class="delAddress">删除</span></div></div>';$(".list-body").append(l),1==e[a].isDefault?$(".list-body").find(".address-name").eq(a).prepend('<span class="isDefault" isDefault="'+e[a].isDefault+'">默认地址</span>'):$(".list-body").find(".options").eq(a).prepend('<span class="defaAds">设为默认地址</span>')}},error:function(e){console.log(e)}})}function a(e,t){$.ajax({url:"/selectArea",type:"POST",dataType:"json",data:{parentId:e},async:!1}).done(function(e){if("省"==t){$("#province").html('<option value="请选择">请选择</option>');for(var a=0;a<e.length;a++)$("#province").append('<option value="'+e[a].id+'">'+e[a].name+"</option>")}else if("市"==t){$("#city").html('<option value="请选择">请选择</option>');for(a=0;a<e.length;a++)$("#city").append('<option value="'+e[a].id+'">'+e[a].name+"</option>")}else if("区"==t){$("#county").html('<option value="请选择">请选择</option>');for(a=0;a<e.length;a++)$("#county").append('<option value="'+e[a].id+'">'+e[a].name+"</option>")}})}function e(a){var e=$.getGlobalVal().memberId,t=$("#province").val(),l=$("#city").val(),s=$("#county").val(),n=$.trim($("#addressAlert .address-detail").val()),r=$.trim($("#addressAlert .phone").val()),d=$.trim($("#addressAlert .tel-area").val())+"-"+$.trim($("#addressAlert .tel").val());contactMan=$.trim($("#addressAlert .address-name").val()),a=a||null;var o=$("#addressAlert").attr("isDefault")?$("#addressAlert").attr("isDefault"):0;if("请选择"==t||"请选择"==l||"请选择"==s)return p("请选择省市区",2),!1;if(""==n)return p("请填写详细地址",2),!1;if(""==contactMan)return p("请填写收货人",2),!1;if(""==r&&"-"==d)return p("请填写联系电话",2),!1;if(!/^1[3|4|5|6|7|8|9][0-9]{9}$/.test(r)&&!/^(0[0-9]{2,3}\-)([2-9][0-9]{6,7})+(\-[0-9]{1,4})?$/.test(d))return p("电话号码格式不正确！",2),!1;d="-"==d?null:d;var i=null==(r=""==r?null:r)?d:r;$.ajax({url:"/delivery/addDeliveryAddress",type:"POST",dataType:"json",data:{memberID:e,isDefault:o,countryID:1,districtID:t,city:l,county:s,address:n,mobile:r,telephone:d,phone:i,contactMan:contactMan,addressID:a},success:function(e){e.success&&(layer.close(c),p(a?"修改地址成功":"添加地址成功",1)),u()},error:function(e){console.log(e)}})}$(".address-table h3 span").click(function(){$("#addressAlert").attr({alertType:"0"}),$("#province").val("请选择"),$("#city").val("请选择"),$("#county").val("请选择"),$("#addressAlert .address-detail").val(""),$("#addressAlert .phone").val(""),$("#addressAlert .tel-area").val(""),$("#addressAlert .tel").val(""),$("#addressAlert .address-name").val(""),layui.use("layer",function(){c=layer.open({type:1,area:"590px",title:["新增收货地址","background-color: #E8E8E8;"],content:$("#addressAlert"),cancel:function(){}})}),a(null,"省")}),u(),$("#province").change(function(){if("请选择"==$(this).val())return $("#city").html('<option value="请选择">请选择</option>'),$("#county").html('<option value="请选择">请选择</option>'),!1;$("#city").html('<option value="请选择">请选择</option>'),$("#county").html('<option value="请选择">请选择</option>'),a(Number($(this).val()),"市")}),$("#city").change(function(){if("请选择"==$(this).val())return $("#county").html('<option value="请选择">请选择</option>'),!1;$("#county").html('<option value="请选择">请选择</option>'),a(Number($(this).val()),"区")}),$(".modify-btn").click(function(){"0"==$("#addressAlert").attr("alertType")?e():"1"==$("#addressAlert").attr("alertType")&&e($("#addressAlert").attr("addressID"))}),$(".list-body").on("click",".modifyAddress",function(){$.ajax({url:"/delivery/getDeliveryAddressByMemberID?memberID="+$.getGlobalVal().memberId+"&addressID="+$(this).parent().parent().attr("addressID"),type:"GET",data:"json",data:{},success:function(e){$("#addressAlert").attr({alertType:"1",addressID:e.data.addressID,isDefault:e.data.isDefault}),a(null,"省"),a(e.data.districtID,"市"),a(e.data.city,"区"),$("#province").val(e.data.districtID),$("#city").val(e.data.city),$("#county").val(e.data.county),$("#addressAlert .address-detail").val(e.data.address),$("#addressAlert .phone").val(e.data.mobile),""!=e.data.telephone&&null!=e.data.telephone&&($("#addressAlert .tel-area").val(e.data.telephone.split("-")[0]),$("#addressAlert .tel").val(e.data.telephone.split("-")[1])),$("#addressAlert .address-name").val(e.data.contactMan),layui.use("layer",function(){c=layer.open({type:1,area:"590px",title:["修改收货地址","background-color: #E8E8E8;"],content:$("#addressAlert"),cancel:function(){}})})},error:function(e){console.log(e)}})}),$(".list-body").on("click",".delAddress",function(){var a=this;layui.use("layer",function(){layer.confirm("您确定删除该地址吗?",{icon:3,title:"删除提示",area:"300px"},function(e){layer.close(e),$.ajax({url:"/delivery/delDeliveryAddress",type:"POST",dataType:"json",data:{memberID:$.getGlobalVal().memberId,addressID:$(a).parent().parent().attr("addressID")},success:function(e){console.log(e),e.success?p("删除地址成功",1):p(e.msg||"除地址成功",2),u()},err:function(e){console.log(e)}})},function(e){layer.close(e)})})}),$(".list-body").on("click",".defaAds",function(){var a=$(this).parent().parent().attr("addressID");layui.use("layer",function(){layer.confirm("您确定把该地址设为默认地址吗?",{icon:3,title:"默认地址提示",area:"300px"},function(e){layer.close(e),$.ajax({url:"/delivery/isDefualt",type:"POST",dataType:"json",data:{memberID:$.getGlobalVal().memberId,addressID:a,isDefault:1},success:function(e){e.success&&p("默认地址设置成功",1),u()},err:function(e){console.log(e)}})},function(e){layer.close(e)})})});var p=function(e,a){layui.use("layer",function(){layer.msg(e,{icon:a,time:1e3})})}});